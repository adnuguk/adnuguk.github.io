
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Aberdeen Developers .Net User Group - Writing Testable Validation Code Using Dependency Injection</title>
        <meta name="description" content="Aberdeen Developers .Net User Group" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Aberdeen Developers .Net User Group" href="/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="Aberdeen Developers .Net User Group" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Aberdeen Developers .Net User Group" />
        <meta name="msapplication-tooltip" content="Aberdeen Developers .Net User Group" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Aberdeen Developers .Net User Group - Writing Testable Validation Code Using Dependency Injection" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://www.aberdeendevelopers.co.uk/blog/writing-testable-validation-code-using-dependency-injection" />
        <!-- TODO: More social graph meta tags -->

        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Aberdeen Developers .Net User Group</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                <li><a href="/about">About</a></li>
<li><a href="/blog">Archive</a></li>
<li><a href="/tags">Tags</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Writing Testable Validation Code Using Dependency Injection</h1>
    <div class="meta">        
Published on 02 February 2011<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/article" class="btn btn-default btn-xs">article</a>
                    <a role="button" href="/tags/dependency-injection" class="btn btn-default btn-xs">dependency injection</a>
                    <a role="button" href="/tags/mvc" class="btn btn-default btn-xs">mvc</a>
                    <a role="button" href="/tags/unit-testing" class="btn btn-default btn-xs">unit testing</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<p><strong>This article was submitted to the Aberdeen Developers .Net User Group by Norman Noble.</strong></p>
<p>The idea for writing this came about when I was discussing <a href="http://www.asp.net/mvc">ASP.Net MVC</a> (Model View Controller) with an old friend Dave about a week ago. I was having a look at Microsoft's latest version having briefly looked at MVC when it first came out with version 3.5 of the .Net Framework. Dave's company had just successfully released their first commercial application written entirely in MVC and I was keen to hear his thoughts on things that he knew now that he wished he'd known at the start of the project. Dave told me that in the start they had followed the <a href="http://nerddinnerbook.s3.amazonaws.com/Intro.htm">NerdDinner tutorial</a> and had adopted the patterns used by the tutorial. He also told me that he was particularly impressed with the way that the tutorial had handled its validation code and that they saw that as the way forward. I decided that the best way to get back into this stuff was as ever to start cutting some code.</p>
<p>The tutorial is easy enough to follow and is very good at explaining the basics of MVC so if MVC is something you are interested in I would thoroughly recommend going through the tutorial. It will give you all you need to get going (<a href="http://stackoverflow.com/">Stack Overflow</a> can fill in the rest). One of the fundamental advantages MVC provides over standard ASP.Net development is that it makes your code easier to test. By testing I mean proper unit testing using a Framework like <a href="http://www.nunit.org/">NUnit</a> or Visual Studios inbuilt MSTest. If you're new or have limited experience in writing unit tests I would recommend reading <a href="http://artofunittesting.com/">the art of UNIT TESTING</a> by Roy Osherove. It's an excellent read with lots of really useful tips based on the experience of both failed and successful projects. When it comes to unit testing and <a href="http://en.wikipedia.org/wiki/Test-driven_development">TDD</a> Roy really knows what he is talking about.</p>
<p>Getting back to the MVC tutorial, I followed it through section by section and eventually arrived at the section on validation. I was quite keen to see what was suggested as Dave had been particularly enthusiastic about how this example handled it. I was slightly disappointed to find that the validation was some simple schema based validation using partial classes on the existing LINQ to SQL classes. To give the article some credit it does explain quite thoroughly that schema based validation is not the greatest and should only be used in the simplest of cases where there are little or no business rules to be applied. You can see a full example of Schema based validation in <a href="http://nerddinnerbook.s3.amazonaws.com/Part3.htm">part 3</a> of the tutorial.</p>
<p>A basic example looks something like this:</p>
<p><a href="http://www.aberdeendevelopers.co.uk/wp-content/uploads/876f59b7-2636-4af8-b201-0447ad4fd6c0.png"><img src="http://www.aberdeendevelopers.co.uk/wp-content/uploads/876f59b7-2636-4af8-b201-0447ad4fd6c0_thumb.png" class="img-fluid" alt="876f59b7-2636-4af8-b201-0447ad4fd6c0" /></a></p>
<pre><code class="language-csharp">partial class Customer
{
    public bool IsValid()
    {
        bool isValid = true;

        if (Age &lt; 18)
        {
            isValid = false;
        }

        return isValid;
    }
}
</code></pre>
<p>This got me to thinking about what I didn't like about this particular method of performing validation and more importantly how I'd prefer to see it being done. In my opinion most validation is part of the business rules of a system and as such should be stored in the Business Layer of the application. Also having the validation in the Data Access Layer creates a dependency on the Data Store when creating unit tests which prevent your tests from being fully robust and subject to change should the data in the data store change.</p>
<p>A test for the code above may look something like:</p>
<pre><code class="language-csharp">[TestMethod]
public void Customer_Over18_IsValid()
{
    //Arrange
    Customer cs = CustomerRepository.GetCustomer(1);

    //Act
    bool isValid = cs.IsValid();

    //Assert
    Assert.IsTrue(isValid);
}
</code></pre>
<p>So as mentioned above this unit test is dependant on a Data Store (in this case a repository) which could be subject to change. This could then potentially break the unit test even though neither the validation functionality nor the Customer object have not changed.</p>
<p>The way I prefer to get round this is to create a validation class for each Entity in the business layer that contains a method that allows me to pass in the entity to be validated. This solves the two problems that I have by moving the validation code into the Business Layer allowing you to centralise all validation code instead of having some in the DAL and some in the BLL. It also removes the dependency on the actual entities as when writing your tests you can create stub objects that use the primary objects as base classes. You can then use these stubs in your unit tests assured that the validation functionality is being properly tested and will not be subject to breaking should your Data Store or its functionality change.</p>
<p>A basic example of this would be:</p>
<pre><code class="language-csharp">public class CustomerValidator : ICustomerValidator
{
    public static bool IsValid(Customer cs)
    {
        bool isValid = true;

        if (cs.Age &lt; 18)
        {
            isValid = false;
        }

        return isValid;
    }
}
</code></pre>
<p>This method completely separates the validation code from any dependencies as they can be injected in through the method call.</p>
<p>A test for the code above would look something like this:</p>
<pre><code class="language-csharp">[TestMethod]
public void Customer_Over18_IsValid()
{
    //Arrange
    StubCustomer scs = new StubCustomer(&quot;Norman&quot;, &quot;Aberdeen&quot;, 31);

    //Act
    bool isValid = CustomerValidator.IsValid(scs);

    //Assert
    Assert.IsTrue(isValid);
}
</code></pre>
<p>In the example above the StubCustomer class has been created which has the Customer class as a base class. As the creation of the item under test is now controlled the unit test is far more robust and is only concerned with the functionality it is supposed to be testing. Therefore the only thing that will break this test is a change in the functionality of Customer which is what you would expect.</p>
<p>There are variations of the example above. For instance you may prefer to &quot;inject&quot; the dependency through a property setter instead. The above example is simply the way I prefer to do it.</p>


<div id="disqus_thread"></div>
<script type="text/javascript" src="/assets/js/disqus.js"></script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                <ul class="list-inline text-center">
                        <li>
                        <a href="https://twitter.com/adnuguk">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://github.com/adnuguk">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                </ul>
                <p class="copyright text-muted">
                        Copyright © 2020 by Aberdeen Developers .Net User Group. This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
                        <br />
                        <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <a href="https://github.com/adnuguk/adnuguk.github.io"><i class="fa fa-github"></i> This Site on GitHub</a> | <strong><a href="https://wyam.io">Generated by Wyam</a></strong>
                </p>
                </div>
        </div>
</div>

                </footer> 

                <script src="/assets/js/jquery.min.js"></script>
                <script src="/assets/js/bootstrap.min.js"></script>     
                <script src="/assets/js/highlight.pack.js"></script>   
                <script src="/assets/js/clean-blog.js"></script>
                <script src="/assets/js/d3.v3.min.js"></script>
                <script src="/assets/js/trianglify.min.js"></script>
                <script src="/assets/js/please-compressed.js"></script>
                <script src="/assets/js/background-check.min.js"></script>

                <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
                <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
                <!--[if lt IE 9]>
                        <script src="/assets/js/html5shiv.js"></script>
                        <script src="/assets/js/respond.min.js"></script>
                <![endif]-->
                
                <script type="text/javascript" src="/assets/js/google.js"></script>
<script type="text/javascript" src="/assets/js/anchor.min.js"></script>
<script type="text/javascript" src="/assets/js/clipboard.min.js"></script>
<script type="text/javascript" src="/assets/js/anchor.js"></script>

                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

